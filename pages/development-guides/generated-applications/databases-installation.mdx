import { Callout, Tab, Tabs, Steps } from 'nextra-theme-docs';

# Database Installation

ROQ already provides a managed database even for local development purposes. The default database that ROQ provides is PostgreSQL. You can use this database or setup your own locally. 

The database URL is set in the environment variable `DATABASE_URL`. You will find the database variable and other required environment variables on the ROQ Console **Get Started** page or **Application Details** page. 

## PostgreSQL

PostgreSQL is a powerful, open source object-relational database system with over 35 years of active development that has earned it a strong reputation for reliability, feature robustness, and performance.

To install PostgreSQL in your operating system please follow the steps bellow:

### Windows

You can easily install PostgreSQL manually through Windows installer. These are general steps to install it:

#### Installation

Download the PostgreSQL installer for Windows from a certified [EDB](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads) website. The Windows installer only supports 64-bit systems, and we will use PostgreSQL 15 version in this documentation.

The installation for Windows is pretty straight forward process, just click the installer and follow the installation next process.

![postgres install start](/postgresql-install-1.png)

Leave every options as default, what you need to be aware of is you have to set the database password because you will need it later.

![set postgres password](/postgresql-install-password.png)

The default PostgreSQL port installation is at **5432**, with the username and password will be used to form the database URL set in the `DATABASE_URL` environment variable. 

For example, with the default username is `postgres`, the database name is `library`, running on local host and the password is `mypassword`, we can form the database URL as:

```shell
postgresql://postgres:mypassword@localhost:5432/library
```

#### Create Database

You can check the PostgreSQL installation with `psql` CLI tool or with **pgAdmin** GUI tool on Windows.

**pgAdmin** is designed to meet the needs of both novice and experienced Postgres users alike, providing a powerful graphical interface that simplifies the creation, maintenance and use of database objects.

<Callout type="info">
The **pgAdmin** tool is bundled with the PostgreSQL server installation there is no need additional installation step.
</Callout>

With this tool we can easily create a database for our generated application.

![create a database on pgadmin](/pgadmin-create-db.png)

#### `DATABASE_URL`

The last step is to replace `DATABASE_URL` environment variable in the `.env` with the PostgreSQL local URL:

```ini
DATABASE_URL=postgresql://postgres:mypassword@localhost:5432/library
```

and we should restart application to pickup any changes on `.env` file.

<Callout type="info">
To run the generated application for local development please read this [documentation](/development-guides/run-local-development).
</Callout>


### Ubuntu Linux

When installing PostgreSQL on Linux, if you need a version not included in the distribution, you must add the PostgreSQL repository. Let's take the Ubuntu distribution.

<Callout type="info">
For other Linux distribution installation, please go to the PostgreSQL official [website](https://www.postgresql.org/download/).
</Callout>

#### Installation

We will use Ubuntu 20.04 and you need to run scripts below to install PostgreSQL 15:

```shell
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt-get update
sudo apt-get -y install postgresql-15
```

To check if PostgreSQL is already running or not, using `systemd` service:

```shell
sudo systemctl status postgresql
```

If it's not running yet, you can start it with this command:

```shell
sudo systemctl start postgresql
```

#### Create Database

The installation procedure created a user account called `postgres` that is associated with the default Postgres role. There are a few ways to utilize this account to access Postgres. One way is to switch over to the postgres account:

```shell
sudo -i -u postgres
```
Basically the command above is changed Linux user as `postgres` user. With this user we can create  a new database, let's name it `library`:

```shell
postgres@GenAI:~$ createdb library
```
To connect to the `library` databas, you can use `-d` option:

```shell
postgres@GenAI:~$ psql -d library
psql (15.4 (Ubuntu 15.4-1.pgdg20.04+1))
Type "help" for help.

library=#
```

To get the connection information, you can use the `\conninfo` command:

```shell
library=# \conninfo
You are connected to database "library" as user "postgres" via socket in "/var/run/postgresql" at port "5432". 
```

To set password for the `library` database, you can use this query:

```shell
ALTER USER postgres WITH PASSWORD 'mypassword';
```

Then with all these informations we can form the URL database for our generated application:

```shell
postgresql://postgres:mypassword@localhost:5432/library
```

#### `DATABASE_URL`

The last step is to replace `DATABASE_URL` environment variable in the `.env` with the PostgreSQL local URL:

```ini
DATABASE_URL=postgresql://postgres:mypassword@localhost:5432/library
```

and we should restart application to pickup any changes on `.env` file.

<Callout type="info">
To run the generated application for local development please read this [documentation](/development-guides/run-local-development).
</Callout>


## Docker

Another option to use PostgreSQL without installation manually is by use Docker. 

<Callout type="info">
Docker is an open platform for developing, shipping, and running applications. To install Docker in your operating system, go to [get docker](https://docs.docker.com/get-docker/).
</Callout>

### Installation

To install PostgreSQL docker version you need to pull the image run this command in the terminal:

```shell
docker pull postgres:15
```
To check the PostgreSQL image is on the system, run the `docker` command in the terminal:

```shell
E:\_workspaces>docker images
REPOSITORY                         TAG       IMAGE ID       CREATED       SIZE
postgres                           15        3a1d35a2fb77   2 hours ago   586MB
```

### Create Database 

To run PostgreSQL docker you need to set database user password, initialize database, and setting the port, we can set these configurations at once in the terminal with this command:

```shell
docker run --name postgres-15 -e POSTGRES_PASSWORD=mypassword -e POSTGRES_DB=library -v D:/data:/var/lib/postgresql/data -d postgres:15 -p 4000:5432
```
The command above will also create a `library` database and mount persistent storage on Windows directory `D:\data`. The command parameters information:

- **Instance Name**: `postgres-15`
- **Username**: `postgres`
- **Password**: `mypassword`
- **Database Name**: `library`
- **Port**: `4000`
- **Database Data**: `D:\data` (for another operating system, you can adjust this value.)

With the information above we can use `psql` to connect to this database:

```shell
psql -h localhost -U postgres -p 4000
```

or if you prefer pgAdmin to connect to this database:

![pgadmin docker](/pgadmin-docker.png)

### `DATABASE_URL`

After we know the PostgreSQL database URL now we can easily connect it with our generated application:


```ini
DATABASE_URL=postgresql://postgres:mypassword@localhost:4000/library
```

and we should restart application to pickup any changes on `.env` file.